#Вступление

В качестве вступления - небольшой обзор предыдущих серий. В конце вступления будет один мозговзрывающий факт насчет этого хабропоста. Сразу за ним - подробное изложение программы.

Почему тебе, дорогой хаброжитель, вообще стоит слушать какого-то маркетолога, который пишет эту статью? Что он может понимать в нашем нелегком труде? За этой инфой пришлось слазить в самые темные глубины LinkedIn: когда-то давно, в 2010 году я устроился в одну небольшую уютную компанию в Новосибирском Академгородке на первую свою работу Java-программистом. Чтобы немножко изучить продукт, руководство поручило ответственную миссию: вручную бегать по интерфейсу нашего веб-приложения, прокликивать кнопочки, и выдергивать оттуда ошибки. Довольно скоро мне поручили придумывать тест-планы, а потом и вовсе дали невероятно ответственную задачу: написать совершенно новый фреймворк для автоматического тестирования. 

<cut/>

Как жестоко они ошиблись в моих умственных способностях! Оказалось, что тестирование - это не хухры-мухры. Ближайшие несколько месяцев пришлось изойти на кровь и пот, пытаясь взять штурмом несколько направлений: одновременно написать на Java систему удаленного выполнения тестов (открывая параллельные коннекты по SSH - сначала с помощью костыля в виде вызова питона из джавы, и pyexpect для ввода пароля - нельзя было авторизовываться по ключам, не спрашивайте почему). На серверах стоял не весь нужный софт, и админы не хотели ставить нужный, поэтому пришлось написать фреймворк для сборки из исходников небольшого дистрибутива GNU прямо в домашней директории текущего пользователя. Самое чудовищное - это тесты на перфоманс, я их не понимал тогда, да и не понимаю сейчас (впрочем, должен ли быть маркетолог особо умным существом? :)

Потом надо было результаты тестов собирать и визуализировать, чтобы отдавать заказчику в PDF. Как сейчас помню, я выбрал для написания и последующей визуализации фреймворк Concordion  - это такой BDD фреймворк для Java. Почему не Cucumber? Его еще не было. Зато в Concordion было все так красиво и изящно - тесты внедрялись прямо посреди HTML. Тестов было много, много было своей специфики, приправленной OSGi-безумием со стороны бэкенда. Разработчики меня ненавидели.

Прошли годы, и у нас появилась куча новых инструментов. В 2012 году появился Cucumber для Java, и еще куча всякого BDD, потом весь мир захватили Селениумы и Докеры, и их влияние со временем только росло. К сожалению, я к тому времени уже ушел из тестирования и просто со стороны молча завидовал всем этим ништякам. Еще бы, больше тебе не нужно самому скриптовать постоянно отваливающийся SSH, ведь можно невозбранно заюзать Ansible.

Аналогичным образом изменялись и конференции для тестировщиков: люди всё больше внедряли новые инструменты, и могли уже сказать что-то вразумительное. Если в самом начале люди говорили просто о попытке внедрения чего-то нового, то со временем все больше докладов начало концентрироваться на реальных способах использования, проблемах и способах решения, деталях внутреннего устройства инструментов, и так далее.

То есть, сами конференции качественно изменились. Теперь они о том, как внедрении и масшатбировании. Каждое второе слово - про масштабирование. Это может показаться назойливым, но, мне кажется, этого хорошо - раньше о масштабировании можно было только мечтать.

Параллельно с общей эволюцией развивались и конференции JUG.ru Group. Качество докладов, организации, видеотрансляций, дискуссионные зоны.

И вот тут хочется поговорить о программе, потому что как глаза - зеркало души, так и программа - отражение окружающей действительности. Там ниже я аккуратно выпишу все основные доклады, но во вступлении - остановимся на трендах.

* **Во-первых**, нужно отметить укрепление направления мобильной разработки. Что общего у Тинькофф, Яндекс и Badoo? Они все пришли на Heisenbug 2018 Moscow. А еще, они все делают доклады про мобилки.

* **Во-вторых**, вечные темы никуда не девались. Jenkins, flaky тесты, Selenium - от них не скрыться. Я бы сказал, творится какое-то засилие Selenium, он в каждом третьем докладе или явно, или намеками присутствует. А еще - докер и масштабирование. При чем тут вообще докер? Докер - всегда при чем!

* **В-третьих**, есть и довольно нестандартные темы. Вячеслав Аленьков [расскажет про тестирование в Росатоме](https://heisenbug-moscow.ru/talks/2017/msk/2p3ugzjvbucmsgy86qask6/), точнее - про цифровой запуск АЭС (атомных электростанций). Как вам такой стандарт качества? Рома Поборчий [с докладом про A/B тестирование](https://heisenbug-moscow.ru/talks/2017/msk/g6ie0nvjae06wge04iayk/) даст возможность почувствовать себя немножечко data scientist'ами. А еще у нас есть отличный [доклад Александра Шукова из World of Tanks](https://heisenbug-moscow.ru/talks/2017/msk/31zwck9sa4goccu0ygo2qq/), внезапно, про World of Tanks. Уже интитивно понятно, что в такой популярной игре всё должно быть на очень хорошем уровне, на их примере стоит поучиться. Эти люди рассказывают не о внедрении какой-то новой хипстерской технологии, а об успешном решении проблем в крупных проектах, и решения эти проверены временем и репутацей.

У меня закончились точки-буллеты в списке, поэтому еще пара интересного в один абзац! На конференциях JUG.ru Group традиционно проводятся [доклады со всевозможными паззлерами](https://jokerconf.com/2017/talks/4w63aqdj4saeooguiamo6w/) - вот и [до нас они добрались](https://heisenbug-moscow.ru/talks/2017/msk/74qfnsvag4gcsi4sw8gyoi/). Доклад с паззлерами будет в самом начале, утром, и кто привык просыпаться не с помощью кофе, а с помощью интересных задачек - милости просим.

Конечно, доклады читают проверенные временем спикеры вроде [Николая Алименкова](https://heisenbug-moscow.ru/talks/2017/msk/1jtizrll7mqmscigqqoeqo/) и хАртема Ерошенко](https://heisenbug-moscow.ru/talks/2017/msk/3dbmqkrm5waqwummcu44ea/). У Артема архитектурный доклад про тесты, таких докладов не так много бывает.

А еще на этой конференции будут реальные звезды, знаменитости: [Саймон Стюарт](https://heisenbug-moscow.ru/talks/2017/msk/4axfxghfmo0ke0oyyack6g/) (человек, являющийся живым воплощением Selenium на Земле) и [Алан Пейдж](https://heisenbug-moscow.ru/talks/2017/msk/65awpkh6vyyquuy0kgk0ww/)(бывший диретор по тестированию в Microsoft, действующий директор по качеству в Unity).

Ну и конечно, в конце будет знатное афтепати! С жидкостями для принятия внутрь, музыкой, теплыми ламповыми беседами - все как положено. Просто приходите, будет круто.

Интересный момент: раньше на нас жутко ругались, что мы сразу после закрытия конференции берем спикеров и куда-то уводим. И в результате, на вечеринке не оставалось почти ни одного спикера. На самом деле, в этом есть смысл: кому-то надо прийти в себя после напряженного доклада, у кого-то через час самолёт. Но и в твоем возмущении, дорогой читатель, есть большая доля смысла, и вообще - клиент всегда прав. Поэтому, в этот раз мы постараемся, чтобы спикеры пришли на вечеринку и употребляли жидкости вместе с нами. Гарантий дать не могу, мы но постараемся.

##Немного дичи об этом посте

Вообще, если человек однажды научается писать код (например, код тестов), от осознания этой своей силы он портится. Становится хитрым ленивым существом, желающим автоматизировать всё, что видишь. Если есть тест - его надо автоматизировать! Если есть пост - его эээ... тоже надо автматизировать!

В ходе написания этого поста мне пришлось перелопатить всю программу конференции - кое-где ее вручную поправить, перевести на русский язык английские тексты, превратить полученный объем данных в хабропост, и так далее. Для этого нужно получить данные о докладах в структурированном виде. Такие данные лежат у нас на сайте в разделе «программа», и я мог бы легко взять их из базы. Если бы позаботился об этом с вечера! Дело в том, что я писал этот пост глубокой ночью, когда грехи наиболее сильно скребут душу, и строчки ложатся на бумагу наиболее гладко. В этот час амдины спят, и если бы я разбудил админа с просьбой дать дамп базы, разговор получился бы прямо скажем, напряженный.

Поэтому я взял в руки вебдрайвер и написал простенький скрейпер таблиц с нашего сайта! Принцип его действия простой: 
* стартует с помощью `SpringBoot` (проект сгенерирован с помощью `Spring Initializr` - очень важно быть ленивым)
* он скачивает страничку (с помощью `jbrowserdriver`),
* потом все странички всех докладов по ссылкам, 
* аккуратно парсит все это (в джавовые объекты типа `Talk` - объект «Доклад» с полями типа «спикер», «компания где он работает», итп),
* и все фотографии спикеров сохраняет на жесткий диск,
* применяет патчи с переводами с русского на английский (простой мердж `ArrayList<Talk>` в Java),
* трансформирует это в Markdown (с помощью шаблонизатора `Velocity` - да, я поклонник старины),
* и на выход формирует текстовый markdown-файл для дальнейшей обработки.

Пара заметок. Вначале я пытался использовать `Unirest` + `jSoup`, но получился какой-то треш. То ли у нас сильно умный JavaScript сидит на сайте, то ли в jSoup баги, но в четыре утра заниматься их поиском не хотелось. А вот `JBrowserDriver` оказался довольно стабильной штукой, и нормально отдает DOM полученный сразу после всех трансформаций, выполняемых браузером после загрузки страниц. Картинки сохраняются на жесткий диск, а не напрямую на HabraStorage, потому что Хабр не дает токен API, а хакать их API поперек их воли - некрасиво. Запуск тестировался относительно Java 9 с параметром `--add-opens java.base/java.lang=ALL-UNNAMED` и Java 8.

Результаты этой бессмысленной и беспощадной работы можно посмотреть [у меня на Гитхабе](https://github.com/olegchir/heisenbug2017moscow-parser).

Главный факап оказался в том, что я не подумавши начал писать это без тестов. В результате изначальная оценка проекта по написанию парсера + получению исходника статьи из 20 минут быстро превратилась в 2 часа. 

Стыдно, очень стыдно. Это Олег, и он криворукий. Не будь как Олег, **всегда пиши юнит-тесты**! Особенно когда разрабатываешь подобие компилятора (даже такого простого как парсер веб-странички). С другой стороны, должен ли сотрудник отдела маркетинга быть умным существом? Короче, мне простительно. А вам - нет, так-то!

На этой жизнеутверждающей ноте, переходим к самому главному - к программе!